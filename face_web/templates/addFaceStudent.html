<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cung Cấp Dữ Liệu Khuôn Mặt - Hệ Thống Điểm Danh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .smooth-transition {
            transition: all 0.3s ease-in-out;
        }
        .progress-bar-inner {
            transition: width 0.2s ease-out;
        }
        video {
            transform: scaleX(-1); 
        }
        .main-container {
            animation: fadeIn 0.8s ease-in-out;
            width: 100%;
            max-width: 1200px; 
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .cls-3{
            fill: #E6EBF1;
        }
        .cls-4{
            fill: #ebc94c;
        }
        .cls-5{
            stroke: #ebc94c;
            stroke-miterlimit: 10;
            stroke-width: 1.5px;
            fill: none;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-100 via-white to-slate-200 min-h-screen flex items-center justify-center p-4 selection:bg-indigo-500 selection:text-white">
    <div class="bg-white/80 backdrop-blur-xl shadow-2xl rounded-2xl p-6 md:p-8 w-full main-container border border-white/50">
        <div class="grid grid-cols-1 md:grid-cols-5 md:gap-8">
            <div class="md:col-span-3 flex flex-col space-y-4">
                <div id="instruction-box" class="text-center bg-indigo-600 text-white font-semibold p-3 rounded-lg shadow-md hidden smooth-transition">
                    <p id="instruction-text"></p>
                </div>
                <div class="bg-slate-900 rounded-lg overflow-hidden aspect-video w-full h-[534px] shadow-inner ring-1 ring-black/5 flex-grow">
                     <video id="camera-feed" class="w-full h-full object-cover" autoplay muted playsinline></video>
                </div>
                <canvas id="capture-canvas" class="hidden"></canvas>
                <button id="start-capture-btn" disabled class="w-full bg-gradient-to-r from-indigo-600 to-blue-500 hover:shadow-lg hover:from-indigo-700 hover:to-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow-md smooth-transition flex items-center justify-center space-x-3 disabled:from-slate-400 disabled:to-slate-400 disabled:shadow-none disabled:cursor-not-allowed transform hover:-translate-y-1">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.776 48.776 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Z" />
                    </svg>
                    <span id="button-text">Bắt Đầu Cung Cấp Dữ Liệu</span>
                </button>
            </div>
            <div class="md:col-span-2 flex flex-col space-y-4 mt-8 md:mt-0">
                <div class="text-center">
                    <div class="flex justify-center items-center gap-3 mb-2">
                        <div class="flex items-center">
                            <a class="flex" href="https://fitvaa.edu.vn/">
                                <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1728 371.12" class="block px-0 h-16 w-full fill-current text-blue-900">
                                    <g>
                                        <path class="cls-4" d="m689.84,217.4h8.19v20.96h.22l16.42-20.96h9.09l-14.19,18,16.59,28.12h-9.04l-12.47-21.69-6.62,8.23v13.46h-8.19l-.02-46.12h0Z"></path>
                                        <path class="cls-4" d="m731.94,217.4h8.19v18.52h18.65v-18.52h8.19v46.12h-8.19v-20.45h-18.65v20.45h-8.19v-46.12Z"></path>
                                        <path class="cls-4" d="m776.28,240.29c0-14.92,8.32-23.71,20.34-23.71s20.34,8.85,20.34,23.71-8.32,24.09-20.34,24.09-20.34-9.17-20.34-24.09Zm32.28,0c0-10.35-4.69-16.61-11.94-16.61s-11.94,6.26-11.94,16.61,4.69,16.98,11.94,16.98c7.25-.02,11.94-6.64,11.94-16.98Z"></path>
                                        <path class="cls-4" d="m835.29,217.4h9.6l15.03,46.12h-8.66l-7.03-24.54c-1.46-4.89-2.83-10.14-4.18-15.2h-.28c-1.27,5.1-2.62,10.33-4.09,15.2l-7.09,24.54h-8.34l15.03-46.12Zm-6.17,27.22h21.73v6.41h-21.73v-6.41Z"></path>
                                        <path class="cls-4" d="m877.3,240.63c0-15.09,9.45-24.07,21.13-24.07,5.77,0,10.39,2.77,13.29,5.83l-4.37,5.29c-2.38-2.38-5.14-4.01-8.74-4.01-7.5,0-12.9,6.36-12.9,16.7s4.97,16.89,12.69,16.89c4.09,0,7.25-1.89,9.84-4.74l4.37,5.14c-3.75,4.33-8.55,6.71-14.53,6.71-11.6.02-20.79-8.47-20.79-23.73Z"></path>
                                        <path class="cls-4" d="m917.92,240.29c0-14.92,8.32-23.71,20.34-23.71s20.34,8.85,20.34,23.71-8.32,24.09-20.34,24.09-20.34-9.17-20.34-24.09Zm32.28,0c0-10.35-4.69-16.61-11.94-16.61s-11.94,6.26-11.94,16.61,4.69,16.98,11.94,16.98,11.94-6.64,11.94-16.98Zm-16.31-35.75h8.74l6.82,7.87-3.52,2.32-7.54-6.21h-.28l-7.54,6.21-3.52-2.32,6.84-7.87Z"></path>
                                        <path class="cls-4" d="m967.9,217.4h8.42l14.34,25.93,4.76,9.84h.28c-.39-4.76-1.05-10.59-1.05-15.75v-20.02h7.8v46.12h-8.42l-14.34-25.96-4.76-9.8h-.28c.39,4.89,1.05,10.44,1.05,15.58v20.19h-7.8v-46.12Z"></path>
                                        <path class="cls-4" d="m1011.75,240.63c0-15.09,9.56-24.07,21.84-24.07,6.54,0,11.02,2.87,13.93,5.83l-4.37,5.29c-2.32-2.25-5.02-4.01-9.32-4.01-8.19,0-13.68,6.36-13.68,16.7s4.89,16.89,14.13,16.89c2.57,0,5.12-.73,6.58-2.02v-9.95h-8.7v-6.71h16.03v20.34c-3.07,3.09-8.42,5.47-14.73,5.47-12.43,0-21.71-8.49-21.71-23.75Z"></path>
                                        <path class="cls-4" d="m1072.58,217.4h8.42l14.34,25.93,4.76,9.84h.28c-.39-4.76-1.05-10.59-1.05-15.75v-20.02h7.8v46.12h-8.42l-14.34-25.96-4.76-9.8h-.28c.39,4.89,1.05,10.44,1.05,15.58v20.19h-7.8v-46.12Z"></path>
                                        <path class="cls-4" d="m1116.43,240.63c0-15.09,9.56-24.07,21.84-24.07,6.54,0,11.02,2.87,13.93,5.83l-4.37,5.29c-2.31-2.25-5.02-4.01-9.32-4.01-8.17,0-13.68,6.36-13.68,16.7s4.89,16.89,14.13,16.89c2.57,0,5.12-.73,6.58-2.02v-9.95h-8.7v-6.71h16.03v20.34c-3.07,3.09-8.42,5.47-14.73,5.47-12.43,0-21.71-8.49-21.71-23.75Z"></path>
                                        <path class="cls-4" d="m1163.17,217.4h8.17v18.52h18.65v-18.52h8.19v46.12h-8.19v-20.45h-18.65v20.45h-8.17v-46.12Z"></path>
                                        <path class="cls-4" d="m1209.94,217.4h27.76v6.88h-19.59v11.81h16.59v6.88h-16.59v13.67h20.28v6.88h-28.48v-46.12h.02Zm9.95-12.86h8.74l6.82,7.87-3.52,2.32-7.54-6.21h-.28l-7.54,6.21-3.52-2.32,6.84-7.87Zm.19,69.59c0-2.68,2.01-4.59,4.8-4.59s4.8,1.91,4.8,4.59-2.01,4.67-4.8,4.67-4.8-1.93-4.8-4.67Z"></path>
                                        <path class="cls-4" d="m1271.3,224.3h-13.31v-6.88h34.83v6.88h-13.31v39.24h-8.19v-39.24h-.02Z"></path>
                                        <path class="cls-4" d="m1300.5,217.4h8.19v18.52h18.65v-18.52h8.19v46.12h-8.19v-20.45h-18.65v20.45h-8.19v-46.12Z"></path>
                                        <path class="cls-4" d="m1344.84,240.29c0-14.92,8.32-23.71,20.34-23.71s20.34,8.85,20.34,23.71-8.32,24.09-20.34,24.09-20.34-9.17-20.34-24.09Zm32.28,0c0-10.35-4.69-16.61-11.94-16.61s-11.94,6.26-11.94,16.61,4.69,16.98,11.94,16.98c7.27-.02,11.94-6.64,11.94-16.98Zm-16.31-35.75h8.74l6.82,7.87-3.52,2.32-7.54-6.21h-.28l-7.54,6.21-3.52-2.32,6.84-7.87Z"></path>
                                        <path class="cls-4" d="m1394.82,217.4h8.42l14.34,25.93,4.76,9.84h.28c-.39-4.76-1.05-10.59-1.05-15.75v-20.02h7.8v46.12h-8.42l-14.34-25.96-4.76-9.8h-.28c.39,4.89,1.05,10.44,1.05,15.58v20.19h-7.8v-46.12Z"></path>
                                        <path class="cls-4" d="m1438.67,240.63c0-15.09,9.56-24.07,21.84-24.07,6.54,0,11.02,2.87,13.93,5.83l-4.37,5.29c-2.31-2.25-5.02-4.01-9.32-4.01-8.17,0-13.68,6.36-13.68,16.7s4.89,16.89,14.13,16.89c2.57,0,5.12-.73,6.58-2.02v-9.95h-8.7v-6.71h16.03v20.34c-3.07,3.09-8.42,5.47-14.73,5.47-12.43,0-21.71-8.49-21.71-23.75Z"></path>
                                        <path class="cls-4" d="m1508.82,224.3h-13.31v-6.88h34.81v6.88h-13.31v39.24h-8.19v-39.24h0Z"></path>
                                        <path class="cls-4" d="m1538.02,217.4h8.19v46.12h-8.19v-46.12Z"></path>
                                        <path class="cls-4" d="m1557.91,217.4h8.42l14.34,25.93,4.76,9.84h.28c-.39-4.76-1.05-10.59-1.05-15.75v-20.02h7.8v46.12h-8.42l-14.34-25.96-4.76-9.8h-.28c.39,4.89,1.05,10.44,1.05,15.58v20.19h-7.8v-46.12Z"></path>
                                    </g>
                                    <g>
                                        <path class="cls-2" d="m554.26,132.76h11.81v20.13h18.03v-20.13h11.81v52.23h-11.81v-21.78h-18.03v21.8h-11.81v-52.25Z"></path>
                                        <path class="cls-2" d="m605.81,158.67c0-17.06,9.64-26.86,23.73-26.86s23.73,9.86,23.73,26.86-9.64,27.29-23.73,27.29-23.73-10.24-23.73-27.29Zm35.36,0c0-10.48-4.5-16.67-11.62-16.67s-11.62,6.19-11.62,16.67,4.5,17.12,11.62,17.12c7.12-.02,11.62-6.66,11.62-17.12Zm-18.15,38.28c0-3.58,2.7-6.15,6.52-6.15s6.52,2.57,6.52,6.15-2.7,6.19-6.52,6.19-6.52-2.57-6.52-6.19Z"></path>
                                        <path class="cls-2" d="m660.65,159.19c0-17.34,11.45-27.37,24.65-27.37,6.75,0,12.2,3.17,15.71,6.77l-6.22,7.57c-2.62-2.46-5.44-4.16-9.22-4.16-7.16,0-12.82,6.32-12.82,16.8s5.01,16.98,12.64,16.98c4.29,0,7.67-2.12,10.22-4.89l6.22,7.42c-4.33,5.04-10.1,7.67-16.87,7.67-13.24-.02-24.3-9.2-24.3-26.79Z"></path>
                                        <path class="cls-2" d="m719.06,132.76h12.5l6.3,24.35c1.56,5.72,2.61,10.99,4.18,16.74h.32c1.57-5.76,2.7-11.04,4.18-16.74l6.17-24.35h12.07l-15.75,52.23h-14.19l-15.78-52.23Z"></path>
                                        <path class="cls-2" d="m770.37,132.76h11.81v52.23h-11.81v-52.23Z"></path>
                                        <path class="cls-2" d="m794.5,132.76h32.73v9.9h-20.92v10.48h17.81v9.9h-17.81v12.04h21.73v9.9h-33.54v-52.21h0Zm10.54-14.68h12.82l7.18,8.87-5.08,3.13-8.34-6.69h-.32l-8.34,6.69-5.08-3.13,7.16-8.87Zm.37,78.87c0-3.58,2.7-6.15,6.52-6.15s6.52,2.57,6.52,6.15-2.7,6.19-6.52,6.19-6.52-2.57-6.52-6.19Z"></path>
                                        <path class="cls-2" d="m838.42,132.76h12.09l13.63,25.98,5.16,11.47h.32c-.56-5.53-1.5-12.84-1.5-19.01v-18.45h11.25v52.23h-12.09l-13.63-26.04-5.16-11.42h-.32c.56,5.76,1.5,12.77,1.5,18.92v18.54h-11.25v-52.23Z"></path>
                                        <path class="cls-2" d="m907.76,132.76h11.81v20.13h18.03v-20.13h11.81v52.23h-11.81v-21.78h-18.03v21.8h-11.81v-52.25Z"></path>
                                        <path class="cls-2" d="m971.52,132.76h14.13l16.4,52.23h-12.5l-6.82-26.45c-1.46-5.23-2.85-11.4-4.24-16.85h-.32c-1.26,5.51-2.66,11.62-4.12,16.85l-6.86,26.45h-12.07l16.4-52.23Zm-7.09-11.77l6.26-7.61,13.68,11.19-5.21,5.91-14.73-9.49Zm1.5,42.4h25.14v9.19h-25.14v-9.19Z"></path>
                                        <path class="cls-2" d="m1007.74,132.76h12.09l13.63,25.98,5.16,11.47h.32c-.56-5.53-1.5-12.84-1.5-19.01v-18.45h11.25v52.23h-12.09l-13.63-26.04-5.16-11.42h-.32c.56,5.76,1.5,12.77,1.5,18.92v18.54h-11.25v-52.23Z"></path>
                                        <path class="cls-2" d="m1058.56,159.19c0-17.34,11.51-27.37,25.46-27.37,7.57,0,12.97,3.24,16.48,6.77l-6.22,7.57c-2.61-2.38-5.38-4.16-9.86-4.16-8.04,0-13.76,6.32-13.76,16.8s4.86,16.98,14.7,16.98c2.1,0,4.26-.54,5.53-1.56v-9.02h-8.66v-9.64h19.14v24.09c-3.6,3.52-9.95,6.32-17.25,6.32-14.36-.02-25.55-9.2-25.55-26.79Z"></path>
                                        <path class="cls-2" d="m1128.2,132.76h11.81v21.33h.28l15.58-21.33h12.99l-15.8,20.85,18.71,31.38h-12.95l-12.69-22.06-6.11,8.06v14h-11.81v-52.23h0Z"></path>
                                        <path class="cls-2" d="m1177.43,132.76h11.81v20.13h18.03v-20.13h11.81v52.23h-11.81v-21.78h-18.03v21.8h-11.81v-52.25Z"></path>
                                        <path class="cls-2" d="m1228.99,158.67c0-17.06,9.64-26.86,23.73-26.86s23.73,9.86,23.73,26.86-9.64,27.29-23.73,27.29-23.73-10.24-23.73-27.29Zm17.32-40.59h12.82l7.18,8.87-5.08,3.13-8.34-6.69h-.32l-8.34,6.69-5.08-3.13,7.16-8.87Zm18.03,40.59c0-10.48-4.5-16.67-11.62-16.67s-11.62,6.19-11.62,16.67,4.5,17.12,11.62,17.12c7.12-.02,11.62-6.66,11.62-17.12Z"></path>
                                        <path class="cls-2" d="m1286.29,132.76h12.11l13.63,25.98,5.16,11.47h.32c-.56-5.53-1.5-12.84-1.5-19.01v-18.45h11.25v52.23h-12.09l-13.63-26.04-5.16-11.42h-.32c.56,5.76,1.5,12.77,1.5,18.92v18.54h-11.25l-.02-52.23h0Z"></path>
                                        <path class="cls-2" d="m1337.12,159.19c0-17.34,11.51-27.37,25.46-27.37,7.57,0,12.97,3.24,16.48,6.77l-6.22,7.57c-2.61-2.38-5.38-4.16-9.86-4.16-8.04,0-13.76,6.32-13.76,16.8s4.86,16.98,14.7,16.98c2.1,0,4.26-.54,5.53-1.56v-9.02h-8.66v-9.64h19.16v24.09c-3.6,3.52-9.95,6.32-17.25,6.32-14.36-.02-25.57-9.2-25.57-26.79Z"></path>
                                        <path class="cls-2" d="m1400.03,132.76h12.5l6.3,24.35c1.56,5.72,2.61,10.99,4.18,16.74h.32c1.57-5.76,2.7-11.04,4.18-16.74l6.17-24.35h12.07l-15.75,52.23h-14.19l-15.78-52.23Z"></path>
                                        <path class="cls-2" d="m1451.34,132.76h11.81v52.23h-11.81v-52.23Z"></path>
                                        <path class="cls-2" d="m1475.47,132.76h32.73v9.9h-20.92v10.48h17.81v9.9h-17.81v12.04h21.73v9.9h-33.54v-52.21h0Zm10.54-14.68h12.82l7.18,8.87-5.08,3.13-8.34-6.69h-.32l-8.34,6.69-5.08-3.13,7.16-8.87Zm.37,78.87c0-3.58,2.7-6.15,6.52-6.15s6.52,2.57,6.52,6.15-2.7,6.19-6.52,6.19-6.52-2.57-6.52-6.19Z"></path>
                                        <path class="cls-2" d="m1529.62,142.68h-14.38v-9.9h40.57v9.9h-14.38v42.33h-11.81v-42.33h0Z"></path>
                                        <path class="cls-2" d="m1580,132.76h12.11l13.63,25.98,5.16,11.47h.32c-.56-5.53-1.5-12.84-1.5-19.01v-18.45h11.25v52.23h-12.09l-13.63-26.04-5.16-11.42h-.32c.56,5.76,1.5,12.77,1.5,18.92v18.54h-11.25l-.02-52.23h0Z"></path>
                                        <path class="cls-2" d="m1643.02,132.76h14.13l16.4,52.23h-12.5l-6.82-26.45c-1.46-5.23-2.85-11.4-4.24-16.85h-.32c-1.26,5.51-2.66,11.62-4.12,16.85l-6.86,26.45h-12.07l16.4-52.23Zm-5.59,30.63h25.14v9.19h-25.14v-9.19Z"></path>
                                        <path class="cls-2" d="m1679.22,132.76h12.9l8.47,23.21c1.05,3.07,1.95,6.43,3,9.64h.32c1.05-3.22,1.93-6.56,2.98-9.64l8.21-23.21h12.9v52.23h-10.76v-19.16c0-5.1.96-12.69,1.5-17.75h-.32l-4.29,12.37-7.39,20h-6.54l-7.4-20-4.16-12.37h-.32c.56,5.06,1.5,12.65,1.5,17.75v19.18h-10.59v-52.25h0Z"></path>
                                    </g>
                                    <g>
                                        <path class="cls-4" d="m257.13,53.71c-5.81-11.83-19.72-18.3-33.59-14.79-15.86,4.03-25.66,19.59-21.88,34.77,3.79,15.18,19.7,24.24,35.56,20.23,5.34-1.35,9.99-4.03,13.67-7.54.58.11,1.16.21,1.74.26,37.91,4.33,114.11,10.78,150.83-2.08,0,.02-69.4,5.21-146.34-30.86Z"></path>
                                        <circle class="cls-4" cx="268" cy="106.4" r="7.46"></circle>
                                        <circle class="cls-4" cx="278.16" cy="42.5" r="10.16"></circle>
                                        <polygon class="cls-5" points="266.69 106.66 336.22 37.28 327.75 123.65 277.22 43.34 363.27 84.15 266.69 106.66"></polygon>
                                        <path class="cls-2" d="m568.1-.08c-41.94,35.81-63.89,45.31-123.69,62.24-28.57,7.22-34.46,20.9-28.53,40.77,1.65,5.55,2.96,11.19,4.14,16.85l5.21,25.1c2.23,10.72,2.76,21.65,4.07,32.53,14.85,122.81-81.21,84.88-128.17-9-2.12-4.26-5.17-8-7.52-12.15-11.94-21.07-29.24-27.07-50.9-20.79L0,199.16c4.2,10.39,8.57,19.89,13.12,28.49l60.46-20.55.99-2.36c-1.48-.77-2.68-2.14-3.24-3.84-1.24-3.52.67-7.35,4.18-8.51,3.54-1.2,7.35.67,8.53,4.22,1.16,3.51-.69,7.29-4.26,8.49-.77.3-1.56.39-2.31.36l-1.63,4.03-61.28,20.81c2.34,4.27,4.71,8.34,7.14,12.15l66.85-23.53,13.63-25.65c-.99-.73-1.71-1.8-2.16-3.06-1.16-3.51.69-7.29,4.26-8.49,3.47-1.2,7.29.69,8.45,4.2,1.2,3.54-.67,7.35-4.22,8.53-1.16.39-2.32.43-3.43.19l-14.21,26.92-67.36,23.75c2.46,3.69,4.97,7.16,7.52,10.37l64.23-21.15,27.69,12.64c.73-.88,1.67-1.54,2.83-1.95,3.54-1.22,7.33.64,8.55,4.18,1.22,3.49-.64,7.33-4.12,8.49-3.54,1.22-7.33-.64-8.55-4.12-.41-1.27-.51-2.55-.17-3.73l-26.45-11.98-61.75,20.36c3.43,4.07,6.94,7.72,10.54,10.91l46.92-16.05,3.75,2.19c.56-.49,1.26-.9,2.04-1.12,3.54-1.22,7.33.64,8.55,4.12,1.22,3.54-.64,7.33-4.18,8.55-3.49,1.22-7.33-.64-8.49-4.18-.58-1.69-.47-3.51.22-5.02l-2.23-1.27-43.96,15.03c17.7,14.51,37.44,18.48,59.39,10.97,6.3-2.16,12.26-5.19,17.81-8.85l110.74-72.64c2.96-1.95,6.26-3.36,9.75-3.94,7.31-1.24,13.57.99,18.86,6.47.9.94,1.71,1.95,2.47,2.98,75.77,102.37,182.8,115.2,201.92,36.33,1.89-7.84,2.64-15.9,2.47-23.94l-1.59-79.79c-1.63-35.6,4.59-37.89,22.03-59.26L568.1-.08ZM122.49,227.26c-4.56,1.52-9.6-.96-11.12-5.51-1.52-4.63.96-9.6,5.51-11.12,4.59-1.56,9.56.9,11.12,5.51,1.54,4.56-.9,9.56-5.51,11.12Z"></path>
                                        <path class="cls-4" d="m237.31,218.45l-126.39,100.24c6.04,6.15,11.9,11.64,17.64,16.48l33.52-27.86.06-1.87c-1.22-.13-2.38-.77-3.22-1.78-1.76-2.08-1.46-5.19.62-6.9,2.12-1.74,5.19-1.46,6.92.66,1.71,2.08,1.42,5.16-.67,6.9-.45.41-.96.67-1.48.84l-.06,3.17-33.97,28.23c2.74,2.25,5.46,4.37,8.12,6.32l36.99-31.44,2.59-21.05c-.86-.24-1.63-.79-2.27-1.52-1.71-2.08-1.42-5.16.67-6.9,2.06-1.72,5.16-1.42,6.88.66,1.74,2.12,1.46,5.19-.66,6.92-.69.56-1.46.9-2.29,1.01l-2.66,22.08-37.23,31.7c2.66,1.87,5.29,3.58,7.89,5.16l35.75-29.15,22.2,1.39c.26-.79.73-1.48,1.42-2.08,2.1-1.76,5.17-1.48,6.94.62,1.74,2.06,1.48,5.17-.6,6.88-2.1,1.76-5.17,1.48-6.92-.58-.6-.75-1.01-1.61-1.09-2.51l-21.18-1.26-34.31,27.99c3.32,1.89,6.58,3.51,9.77,4.87l25.57-21.35,3.13.52c.26-.49.62-.94,1.11-1.29,2.1-1.76,5.17-1.48,6.92.58,1.76,2.1,1.48,5.17-.62,6.94-2.06,1.74-5.17,1.48-6.9-.64-.84-.99-1.24-2.27-1.16-3.49l-1.86-.28-23.92,19.95c19.03,7.35,35.86,4.84,50.26-8.47,3.81-3.52,7.09-7.59,9.88-11.98l55.68-87.19c-8.89-8.51-17.6-18.07-25.96-28.68-3.67-4.69-10.42-5.51-15.09-1.82Zm-36.57,89.83c-2.72,2.23-6.79,1.86-9.04-.86-2.25-2.77-1.86-6.79.86-9.04,2.74-2.27,6.75-1.87,9.04.86,2.21,2.72,1.86,6.77-.86,9.04Z"></path>
                                        <path class="cls-1" d="m101.92,224.58c-4.56,1.52-7.03,6.49-5.51,11.12,1.54,4.56,6.56,7.05,11.12,5.51,4.59-1.56,7.05-6.56,5.51-11.12-1.56-4.61-6.51-7.09-11.12-5.51Z"></path>
                                        <path class="cls-1" d="m297.9,339.98c-2.12-1.16-4.76-.37-5.92,1.74-1.14,2.1-.37,4.74,1.74,5.92,2.1,1.14,4.78.36,5.92-1.74,1.16-2.14.36-4.78-1.74-5.92Z"></path>
                                        <path class="cls-2" d="m230.83,360.85c5.36,2.36,10.48,4.35,15.33,5.94l14.13-26.11-.43-1.2c-.81.22-1.71.13-2.49-.3-1.65-.86-2.25-2.91-1.35-4.52.9-1.63,2.91-2.25,4.54-1.35,1.61.88,2.21,2.91,1.31,4.54-.19.37-.43.67-.73.9l.77,2.02-14.32,26.47c2.31.73,4.56,1.39,6.75,1.93l15.43-29.24-3.69-13.97c-.6.07-1.24-.09-1.82-.39-1.61-.88-2.21-2.91-1.31-4.54.86-1.61,2.91-2.21,4.52-1.33,1.63.9,2.25,2.91,1.35,4.54-.3.54-.69.96-1.2,1.22l3.92,14.64-15.52,29.47c2.16.51,4.26.94,6.3,1.26l15.22-27.5,14.4-4.76c-.04-.56.09-1.12.37-1.67.88-1.65,2.91-2.25,4.54-1.37,1.63.86,2.25,2.91,1.37,4.5-.88,1.65-2.91,2.25-4.52,1.39-.58-.32-1.05-.77-1.31-1.31l-13.7,4.57-14.6,26.4c2.59.36,5.06.56,7.4.6l10.76-19.98,2.12-.47c.04-.37.15-.75.37-1.11.88-1.65,2.91-2.25,4.52-1.39,1.65.88,2.25,2.91,1.37,4.54-.86,1.63-2.91,2.25-4.52,1.35-.79-.43-1.37-1.12-1.61-1.91l-1.24.3-10.07,18.69c14-.19,24.05-6.13,29.77-18.39,1.44-3.11,2.44-6.41,3.07-9.79l11.81-62.41c-9.88-4.97-19.42-13.55-29.36-21.07l-57.65,100.82Zm51.87-24.13c-1.14,2.1-3.82,2.91-5.92,1.74-2.12-1.18-2.91-3.82-1.74-5.92,1.16-2.12,3.81-2.91,5.92-1.74,2.1,1.16,2.91,3.81,1.74,5.92Z"></path>
                                        <circle class="cls-3" cx="230.1" cy="67.32" r="15.69"></circle>
                                        <polygon class="cls-5" points="336.22 37.28 277.22 43.34 266.69 106.66 327.75 123.65 363.36 83.55 336.22 37.28"></polygon>
                                        <path class="cls-2" d="m404.91,94.31s-36.91,7.35-71.8,39.11c-3.96,3.6-10.09,1.74-11.17-3.41h0c-1.39-6.52,2.17-13.27,8.36-15.82,18.2-7.52,55.08-21.46,74.61-19.87Z"></path>
                                        <path class="cls-2" d="m404.91,79.01c-5.4-1.5-55.64-15.47-74.78-61.11-2.42-5.79-11.45-4.24-14.04,1.46h0c-3.26,7.24.47,14.34,5.89,20.13,13.25,14.23,55.73,37.92,82.93,39.52Z"></path>
                                    </g>
                                </svg>
                            </a>
                        </div>
                    </div>
                    <h1 class="text-xl md:text-2xl font-bold text-slate-800">Hệ Thống Điểm Danh</h1>
                     <p class="text-slate-600 mt-2 text-base">Cung Cấp Dữ Liệu Khuôn Mặt</p>
                </div>

                <div>
                    <label for="full-name" class="block text-sm font-medium text-slate-700 mb-2">Họ và tên</label>
                    <input type="text" id="full-name" name="full-name" required class="w-full px-4 py-3 bg-white/50 border border-slate-300/70 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none smooth-transition" placeholder="Nhập họ và tên" />
                </div>

                <div>
                    <label for="student-id" class="block text-sm font-medium text-slate-700 mb-2">Mã số sinh viên</label>
                    <input type="text" id="student-id" name="student-id" required class="w-full px-4 py-3 bg-white/50 border border-slate-300/70 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none smooth-transition" placeholder="Nhập mã số sinh viên" />
                </div>
                
                <div id="progress-container" class="hidden w-full bg-slate-200 rounded-full h-6 overflow-hidden">
                    <div id="progress-bar" class="bg-gradient-to-r from-indigo-500 to-blue-500 h-6 rounded-full text-center text-white text-sm font-medium leading-6 progress-bar-inner flex items-center justify-center" style="width: 0%">
                        0%
                    </div>
                </div>
                
                <div id="status-box" class="p-3 text-sm rounded-lg text-center flex items-center justify-center space-x-2">
                     <span id="status-icon"></span>
                    <p id="status-message">Đang khởi tạo camera...</p>
                </div>
                
                <div class="flex-grow flex flex-col mt-4">
                     <h3 class="text-md font-semibold text-slate-700 mb-2">Ảnh đại diện xem trước:</h3>
                     <div id="image-preview-container" class="bg-slate-100/70 p-3 rounded-lg border border-slate-200/80 flex-grow min-h-[100px] grid grid-cols-5 gap-2">
                     </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const video = document.getElementById('camera-feed');
        const canvas = document.getElementById('capture-canvas');
        const startCaptureBtn = document.getElementById('start-capture-btn');
        const buttonText = document.getElementById('button-text');
        const userNameInput = document.getElementById('student-id');
        const fullNameInput = document.getElementById('full-name');
        const statusBox = document.getElementById('status-box');
        const statusIcon = document.getElementById('status-icon');
        const statusMessage = document.getElementById('status-message');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        const instructionBox = document.getElementById('instruction-box');
        const instructionText = document.getElementById('instruction-text');
        const imagePreviewContainer = document.getElementById('image-preview-container');


        const TOTAL_IMAGES = 250;
        let isCapturing = false;

        // --- Các bước hướng dẫn chụp ảnh ---
        const captureSteps = [
            { instruction: "Vui lòng nhìn thẳng vào camera", end: 40 },
            { instruction: "Từ từ quay đầu sang TRÁI", end: 80 },
            { instruction: "Từ từ quay đầu sang PHẢI", end: 120 },
            { instruction: "Từ từ ngước mặt lên TRÊN", end: 160 },
            { instruction: "Từ từ cúi mặt xuống DƯỚI", end: 200 },
            { instruction: "Lấy ảnh để thử nghiệm", end: 250 }
        ];
        let lastInstruction = "";

        // --- Các điểm chụp ảnh xem trước ---
        const previewCapturePoints = [25, 60, 100, 140, 180];

        // --- 1. Khởi tạo Camera ---
        async function initializeCamera() {
            showStatus('Đang khởi tạo camera...', 'info');
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 640, height: 480 } });
                video.srcObject = stream;
                video.onloadedmetadata = () => {
                    startCaptureBtn.disabled = false;
                    showStatus('Camera đã sẵn sàng. Vui lòng điền tên và nhấn nút.', 'info');
                };
            } catch (err) {
                console.error("Lỗi truy cập camera:", err);
                showStatus(`Lỗi camera: ${err.message}. Vui lòng cấp quyền truy cập camera.`, 'error');
                startCaptureBtn.disabled = true;
            }
        }

        // --- 2. Xử lý quá trình chụp ---
        startCaptureBtn.addEventListener('click', async () => {
            if (isCapturing) return;

            const studentId = userNameInput.value.trim();
            const fullName = fullNameInput.value.trim();
            if (studentId === '') {
                showStatus('Vui lòng nhập tên hoặc mã số sinh viên trước khi chụp.', 'error');
                userNameInput.focus();
                return;
            }

            isCapturing = true;
            startCaptureBtn.disabled = true;
            buttonText.textContent = 'Đang chụp...';
            imagePreviewContainer.innerHTML = ''; // Xóa ảnh xem trước cũ
            progressContainer.classList.remove('hidden');
            instructionBox.classList.remove('hidden');
            lastInstruction = ""; // Reset lại hướng dẫn cuối cùng
            updateProgress(0); // Reset thanh tiến trình

            const capturedImages = [];

            for (let i = 1; i <= TOTAL_IMAGES; i++) {
                const currentStep = captureSteps.find(step => i <= step.end);
                if (currentStep && currentStep.instruction !== lastInstruction) {
                    instructionText.textContent = currentStep.instruction;
                    lastInstruction = currentStep.instruction;
                }

                await new Promise(resolve => setTimeout(resolve, 150)); 
                
                const imageDataUrl = captureFrame();
                capturedImages.push(imageDataUrl);

                if (previewCapturePoints.includes(i)) {
                    addImageToPreview(imageDataUrl);
                }

                updateProgress(i);
            }
            
            instructionBox.classList.add('hidden');
            showStatus('Đã chụp xong. Đang gửi dữ liệu và huấn luyện...', 'info');
            
            // --- Gửi dữ liệu đến API Backend ---
            await sendDataToBackend(studentId, fullName, capturedImages);

            isCapturing = false;
        });
        
        // --- 3. Gửi dữ liệu đến Backend API ---
        async function sendDataToBackend(studentId, fullName, images) {
            try {
                const response = await fetch('http://localhost:5001/add_student_and_train', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        studentId: studentId,
                        images: images
                    }),
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showStatus(`Thành công! ${result.message}`, 'success');
                    try {
                        const responeseSV = await fetch('http/localhost:3000/api/student/create', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                studentId: studentId,
                                name: fullName
                            }),
                        })
                    }
                    catch (error) {
                        console.error('Lỗi khi xử lý kết quả:', error);
                    }
                } else {
                    // Hiển thị lỗi từ server
                    showStatus(`Lỗi từ máy chủ: ${result.message || 'Không có thông báo lỗi cụ thể.'}`, 'error');
                }
            } catch (error) {
                console.error('Lỗi khi gửi dữ liệu đến API:', error);
                showStatus(`Lỗi mạng hoặc kết nối: ${error.message}`, 'error');
            } finally {
                // Kích hoạt lại nút bấm dù thành công hay thất bại
                startCaptureBtn.disabled = false;
                buttonText.textContent = 'Bắt Đầu Cung Cấp Dữ Liệu';
            }
        }


        // --- 4. Hàm chụp một khung hình ---
        function captureFrame() {
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.translate(canvas.width, 0);
            context.scale(-1, 1);
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            return canvas.toDataURL('image/jpeg', 0.9);
        }

        // --- 5. Hàm cập nhật tiến trình ---
        function updateProgress(count) {
            const percentage = Math.round((count / TOTAL_IMAGES) * 100);
            progressBar.style.width = `${percentage}%`;
            progressBar.textContent = `${percentage}%`;
        }

        // --- 6. Hàm hiển thị trạng thái ---
        function showStatus(message, type = 'info') {
            statusMessage.textContent = message;
            statusBox.className = 'p-3 text-sm rounded-lg text-center flex items-center justify-center space-x-2 smooth-transition';
            
            let iconSvg = '';
            if (type === 'success') {
                statusBox.classList.add('bg-green-100', 'text-green-800');
                iconSvg = `<svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>`;
            } else if (type === 'error') {
                statusBox.classList.add('bg-red-100', 'text-red-800');
                iconSvg = `<svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>`;
            } else { // info
                statusBox.classList.add('bg-blue-100', 'text-blue-800');
                iconSvg = `<svg class="w-5 h-5 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;
            }
            statusIcon.innerHTML = iconSvg;
        }

        // --- 7. Thêm ảnh vào khu vực xem trước ---
        function addImageToPreview(imageDataUrl) {
            const img = document.createElement('img');
            img.src = imageDataUrl;
            img.className = 'w-full h-auto object-cover rounded-md aspect-square shadow-sm';
            imagePreviewContainer.appendChild(img);
        }

        // Bắt đầu quá trình khi trang được tải
        initializeCamera();
    </script>
</body>
</html>